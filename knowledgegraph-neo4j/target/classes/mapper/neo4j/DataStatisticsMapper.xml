<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.knowledgegraph.neo4j.mapper.DataStatisticsMapper">

    <select id="selectDataStatisticsUser" resultType="map">
        SELECT
            SUM(C.number) AS number,
            dataday
        FROM
            (SELECT
                 CASE
                     WHEN number IS NULL
                         THEN 0
                     ELSE number
                     END AS number,
                 DATE_FORMAT(A.WEEKDAY,'%m/%d') AS dataday
             FROM
                 (SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 7 DAY
      ) AS WEEKDAY
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 6 DAY
        )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 5 DAY
          )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 4 DAY
            )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 3 DAY
              )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 2 DAY
                )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 1 DAY
                  )) A
                     LEFT JOIN
                 (SELECT
                      COUNT(0) AS number,
                      DATE_FORMAT(create_time,'%Y-%m-%d') AS WEEKDAY
                  FROM
                      sys_user
                  WHERE create_time > DATE_SUB(
                          CURDATE(),
                          INTERVAL WEEKDAY(NOW()) + 8 DAY
                  )) B
                 ON A.WEEKDAY= B.WEEKDAY) C
        GROUP BY C.dataday
    </select>

    <select id="selectDataStatisticsGraph" resultType="map">
        SELECT
            SUM(C.number) AS number,
            dataday
        FROM
            (SELECT
                 CASE
                     WHEN number IS NULL
                         THEN 0
                     ELSE number
                     END AS number,
                 DATE_FORMAT(A.WEEKDAY,'%m/%d') AS dataday
             FROM
                 (SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 7 DAY
      ) AS WEEKDAY
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 6 DAY
        )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 5 DAY
          )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 4 DAY
            )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 3 DAY
              )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 2 DAY
                )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 1 DAY
                  )) A
                     LEFT JOIN
                 (SELECT
                      COUNT(0) AS number,
                      DATE_FORMAT(create_time, '%Y-%m-%d') AS WEEKDAY
                  FROM
                      graph
                  WHERE create_time > DATE_SUB(
                          CURDATE(),
                          INTERVAL WEEKDAY(NOW()) + 8 DAY
                  )) B
                 ON A.WEEKDAY= B.WEEKDAY) C
        GROUP BY C.dataday
    </select>

    <select id="selectDataStatisticsGraphNode" resultType="map">
        SELECT
            SUM(C.number) AS number,
             dataday
        FROM
            (SELECT
                 CASE
                     WHEN number IS NULL
                         THEN 0
                     ELSE number
                     END AS number,
                 DATE_FORMAT(A.WEEKDAY,'%m/%d') AS dataday
             FROM
                 (SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 7 DAY
      ) AS WEEKDAY
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 6 DAY
        )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 5 DAY
          )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 4 DAY
            )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 3 DAY
              )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 2 DAY
                )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 1 DAY
                  )) A
                     LEFT JOIN
                 (SELECT
                      COUNT(0) AS number,
                      DATE_FORMAT(graph_node_time, '%Y-%m-%d') AS WEEKDAY
                  FROM
                      graph_node
                  WHERE create_time > DATE_SUB(
                          CURDATE(),
                          INTERVAL WEEKDAY(NOW()) + 8 DAY
                  )) B
                 ON A.WEEKDAY= B.WEEKDAY) C
        GROUP BY C.dataday
    </select>

    <select id="selectDataStatisticsVideo" resultType="map">
        SELECT
            SUM(C.number) AS number,
             dataday
        FROM
            (SELECT
                 CASE
                     WHEN number IS NULL
                         THEN 0
                     ELSE number
                     END AS number,
                 DATE_FORMAT(A.WEEKDAY,'%m/%d') AS dataday
             FROM
                 (SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 7 DAY
      ) AS WEEKDAY
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 6 DAY
        )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 5 DAY
          )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 4 DAY
            )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 3 DAY
              )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 2 DAY
                )
                  UNION
                  SELECT
                      DATE_SUB(
                              CURDATE(),
                              INTERVAL WEEKDAY(CURDATE()) + 1 DAY
                  )) A
                     LEFT JOIN
                 (SELECT
                      COUNT(0) AS number,
                      DATE_FORMAT(create_time, '%Y-%m-%d') AS WEEKDAY
                  FROM
                      graph_node_video
                  WHERE create_time > DATE_SUB(
                          CURDATE(),
                          INTERVAL WEEKDAY(NOW()) + 8 DAY
                  )) B
                 ON A.WEEKDAY= B.WEEKDAY) C
        GROUP BY C.dataday
    </select>



</mapper>